<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFT Utility Factory — Staking</title>
  <meta name="description" content="Full staking UI for Solana NFT projects: Owner portal and User staking." />
  <link rel="stylesheet" href="/css/styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen">
  <!-- NAVBAR -->
  <header class="navbar glass">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3">
      <img src="/images/Logo.jpg" alt="NFT Utility Factory" class="w-10 h-10 rounded-full"/>
      <span class="font-semibold tracking-wide">NFT Utility Factory</span>
    </a>
    <nav class="hidden md:flex items-center gap-6 text-sm text-zinc-300">
      <a href="/pages/staking.html" class="hover:text-white">Staking</a>
      <a href="/pages/airdrop.html" class="hover:text-white">Airdrop</a>
      <a href="/pages/discord-bot.html" class="hover:text-white">Discord Bot</a>
      <a href="/pages/lottery.html" class="hover:text-white">Lottery</a>
      <a href="/pages/pawnshop.html" class="hover:text-white">Pawn Shop</a>
      <a href="/pages/partner-casino.html" class="hover:text-white">Partner Casino</a>
      <a href="/pages/browser-game.html" class="hover:text-white">Browser Game</a>
      <a href="/index.html#contact" class="hover:text-white">Contact</a>
    </nav>
    <div class="flex items-center gap-2">
      <select id="walletSelect" class="hidden md:block px-3 py-2 rounded-xl glass text-sm"></select>
      <button id="connectBtn" class="btn btn-muted">Connect Wallet</button>
      <button id="disconnectBtn" class="btn btn-muted hidden">Disconnect</button>
    </div>
  </div>
</header>

  <!-- ROUTES WRAPPER -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <section id="route-user" class="space-y-6">
      <div class="flex flex-col lg:flex-row gap-6">
        <div class="flex-1 min-w-0">
          <div class="glass rounded-2xl p-4">
            <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
              <h1 class="text-2xl font-bold">Stake your NFTs</h1>
              <div class="flex gap-2">
                <input id="search" class="w-72 max-w-full glass px-3 py-2 rounded-xl" placeholder="Search projects by name or collection ID" oninput="renderProjects()" />
                <button class="btn btn-muted" onclick="resetSearch()">Clear</button>
              </div>
            </div>
            <p class="text-zinc-300 mt-2 text-sm">Browse verified staking pools. Select a project and stake. Use <strong>Claim All</strong> to collect rewards across pools.</p>
          </div>
          <div id="projects" class="mt-4 grid md:grid-cols-2 xl:grid-cols-3 gap-4"></div>
        </div>
        <aside class="w-full lg:w-80">
          <div class="glass rounded-2xl p-4">
            <div class="flex items-center justify-between"><h2 class="font-semibold">Your Staking</h2><button class="btn btn-primary" onclick="openClaimAll()">Claim All</button></div>
            <div id="portfolio" class="mt-4 space-y-3 text-sm"></div>
          </div>
          <div class="glass rounded-2xl p-4 mt-4"><div class="font-semibold">Tips</div><ul class="list-disc pl-5 mt-2 text-zinc-300 text-sm"><li>Non-custodial in most designs; verify program details.</li><li>Rewards are per‑pool; APR set by owners.</li></ul></div>
        </aside>
      </div>
    </section>

    <section id="route-owner" class="hidden space-y-6">
      <div class="glass rounded-2xl p-5">
        <h1 class="text-2xl font-bold">Owner Portal — Apply for a Staking Pool</h1>
        <p class="text-zinc-300 mt-1 text-sm">Connect with the authority wallet, submit your collection and rewards funding. UI‑only; wire up later.</p>
      </div>
      <div class="grid lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 glass rounded-2xl p-5">
          <div class="grid sm:grid-cols-2 gap-4">
            <div><label class="text-sm text-zinc-300">Project name</label><input id="f_name" class="w-full glass px-3 py-2 rounded-xl" placeholder="e.g., JellyJaguars" /></div>
            <div><label class="text-sm text-zinc-300">Collection ID</label><input id="f_collection" class="w-full glass px-3 py-2 rounded-xl" placeholder="Mint list / verified creator / collection address" /></div>
            <div><label class="text-sm text-zinc-300">Reward token</label><select id="f_token" class="w-full glass px-3 py-2 rounded-xl"><option value="SOL">SOL</option><option value="USDC">USDC</option><option value="TOKEN">Custom SPL Token</option></select></div>
            <div><label class="text-sm text-zinc-300">Initial reward funding</label><input id="f_funding" class="w-full glass px-3 py-2 rounded-xl" placeholder="Amount to lock (e.g., 500 SOL)" /></div>
            <div><label class="text-sm text-zinc-300">Target APR</label><input id="f_apr" class="w-full glass px-3 py-2 rounded-xl" placeholder="e.g., 12%" /></div>
            <div><label class="text-sm text-zinc-300">Min stake lock</label><select id="f_minlock" class="w-full glass px-3 py-2 rounded-xl"><option>None</option><option>7 days</option><option>14 days</option><option>30 days</option></select></div>
            <div><label class="text-sm text-zinc-300">Max staking slots</label><input id="f_slots" class="w-full glass px-3 py-2 rounded-xl" placeholder="e.g., 2000" /></div>
            <div><label class="text-sm text-zinc-300">Contact</label><input id="f_contact" class="w-full glass px-3 py-2 rounded-xl" placeholder="Discord / X / Email" /></div>
            <div class="sm:col-span-2"><label class="text-sm text-zinc-300">Website</label><input id="f_site" class="w-full glass px-3 py-2 rounded-xl" placeholder="https://…" /></div>
            <div class="sm:col-span-2"><label class="text-sm text-zinc-300">Notes</label><textarea id="f_notes" class="w-full glass px-3 py-2 rounded-xl min-h-[120px]" placeholder="Describe rewards model and eligibility."></textarea></div>
          </div>
          <div class="flex items-center gap-3 mt-4"><label class="text-sm flex items-center gap-2"><input id="f_terms" type="checkbox" class="accent-yellow-400"/> I confirm ownership of the collection and funds.</label></div>
          <div class="mt-4 flex gap-3"><button class="btn btn-primary" onclick="submitPool()">Apply</button><button class="btn btn-muted" onclick="resetForm()">Reset</button></div>
        </div>
        <div class="glass rounded-2xl p-5"><div class="flex items-center justify-between"><h2 class="font-semibold">My Pools</h2><span class="text-xs text-zinc-400">UI preview</span></div><div id="mypools" class="mt-3 space-y-3 text-sm"></div></div>
      </div>
    </section>

    <section id="route-faq" class="hidden space-y-6">
      <div class="glass rounded-2xl p-5"><h1 class="text-2xl font-bold">Staking FAQ (UI only)</h1><ul class="list-disc pl-6 mt-3 text-zinc-300"><li>No on-chain calls yet — plug in your backend/RPC.</li><li>Project list comes from JSON (mock in this file).</li><li>“Claim All” aggregates across pools.</li></ul></div>
    </section>
  </main>

  <!-- MODAL -->
  <div id="modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-4"><div class="glass rounded-2xl w-full max-w-lg p-5"><div class="flex items-center justify-between"><h3 id="modalTitle" class="text-xl font-semibold"></h3><button class="text-zinc-400" onclick="closeModal()">✕</button></div><div id="modalBody" class="mt-3 text-sm text-zinc-200"></div><div class="mt-5 flex gap-3 justify-end"><button class="btn btn-muted" onclick="closeModal()">Close</button><button id="modalCta" class="btn btn-primary">Confirm</button></div></div></div>

  <script>
    const PROJECTS=[{id:'jj',name:'JellyJaguars',collection:'COLL_JJ_9xHs…',apr:12,tvl:1800,stakers:642,logo:'/images/Logo.jpg'},{id:'mn',name:'MetaNautz',collection:'COLL_MN_G7k…',apr:9,tvl:950,stakers:210,logo:'/images/Logo.jpg'},{id:'rk',name:'Rogue Koalas',collection:'COLL_RK_A3p…',apr:15,tvl:2300,stakers:1011,logo:'/images/Logo.jpg'},{id:'ot',name:'Orbital Turtles',collection:'COLL_OT_Q1b…',apr:11,tvl:1200,stakers:377,logo:'/images/Logo.jpg'},{id:'bp',name:'Byte Panthers',collection:'COLL_BP_Z2z…',apr:14,tvl:1990,stakers:540,logo:'/images/Logo.jpg'}];
    let portfolio={jj:{staked:3,pendingRewards:1.25},rk:{staked:1,pendingRewards:0.4}};
    function openRoute(name){['user','owner','faq'].forEach(r=>document.getElementById('route-'+r).classList.add('hidden'));document.getElementById('route-'+name).classList.remove('hidden');if(name==='user')renderProjects();if(name==='owner')renderMyPools();}
    function resetSearch(){const el=document.getElementById('search');el.value='';renderProjects();}
    function renderProjects(){const listEl=document.getElementById('projects');const q=(document.getElementById('search').value||'').toLowerCase();const filtered=PROJECTS.filter(p=>p.name.toLowerCase().includes(q)||p.collection.toLowerCase().includes(q));listEl.innerHTML=filtered.map(p=>projectCardHtml(p)).join('');updatePortfolioSidebar();}
    function projectCardHtml(p){const you=portfolio[p.id]||{staked:0,pendingRewards:0};return`<div class="glass rounded-2xl p-4 flex flex-col"><div class="flex items-center gap-3"><img src="${p.logo}" alt="${p.name}" class="w-10 h-10 rounded-full"/><div><div class="font-semibold">${p.name}</div><div class="text-xs text-zinc-400">${p.collection}</div></div></div><div class="grid grid-cols-3 gap-2 text-sm mt-3"><div class="glass rounded-xl p-2 text-center"><div class="text-zinc-400">APR</div><div class="font-semibold">${p.apr}%</div></div><div class="glass rounded-xl p-2 text-center"><div class="text-zinc-400">TVL</div><div class="font-semibold">${p.tvl} SOL</div></div><div class="glass rounded-xl p-2 text-center"><div class="text-zinc-400">Stakers</div><div class="font-semibold">${p.stakers}</div></div></div><div class="mt-3 text-sm text-zinc-300">You: <strong>${you.staked}</strong> staked • Rewards: <strong>${you.pendingRewards} SOL</strong></div><div class="mt-3 flex gap-2"><button class="btn btn-primary" onclick="openStake('${p.id}')">Stake NFTs</button><button class="btn btn-muted" onclick="openUnstake('${p.id}')">Unstake</button><button class="btn btn-muted" onclick="openClaim('${p.id}')">Claim</button></div></div>`}
    function updatePortfolioSidebar(){const box=document.getElementById('portfolio');const rows=PROJECTS.filter(p=>portfolio[p.id]).map(p=>{const r=portfolio[p.id];return`<div class="flex items-center justify-between"><div class="truncate">${p.name}</div><div>${r.staked} NFTs • ${r.pendingRewards} SOL</div></div>`});const total=Object.values(portfolio).reduce((a,b)=>a+(b.pendingRewards||0),0).toFixed(2);box.innerHTML=rows.join('')+(rows.length?`<div class="border-t border-white/10 pt-3 flex items-center justify-between"><div>Total pending</div><div class="font-semibold">${total} SOL</div></div>`:'<div class="text-zinc-400">No active stakes yet.</div>')}
    function openModal(title,bodyHtml,onConfirm){document.getElementById('modalTitle').textContent=title;document.getElementById('modalBody').innerHTML=bodyHtml;const cta=document.getElementById('modalCta');cta.onclick=()=>{onConfirm&&onConfirm();closeModal();};document.getElementById('modal').classList.remove('hidden');document.getElementById('modal').classList.add('flex')}
    function closeModal(){document.getElementById('modal').classList.add('hidden');document.getElementById('modal').classList.remove('flex')}
    function mockNftsHtml(projectId){const items=[1,2,3,4,5,6].map(i=>({mint:`NFT_${projectId}_${i}`,name:`${projectId.toUpperCase()} #${1000+i}`,img:'/images/Logo.jpg'}));return`<div class="grid grid-cols-2 sm:grid-cols-3 gap-3 mt-3">${items.map(n=>`<label class="glass rounded-xl p-2 flex flex-col items-center text-center"><img src="${n.img}" class="w-20 h-20 rounded-lg object-cover"/><div class="text-xs mt-1">${n.name}</div><input type=\"checkbox\" class=\"mt-2 accent-yellow-400\" data-mint=\"${n.mint}\" /></label>`).join('')}</div>`}
    function openStake(projectId){openModal('Stake NFTs',`<div class="text-sm text-zinc-300">Select NFTs to stake into <strong>${projectName(projectId)}</strong>.</div>${mockNftsHtml(projectId)}` ,()=>{portfolio[projectId]=portfolio[projectId]||{staked:0,pendingRewards:0};portfolio[projectId].staked+=2;portfolio[projectId].pendingRewards+=0.1;renderProjects()})}
    function openUnstake(projectId){openModal('Unstake NFTs',`<div class="text-sm text-zinc-300">Choose NFTs to unstake from <strong>${projectName(projectId)}</strong>.</div>${mockNftsHtml(projectId)}` ,()=>{if(portfolio[projectId]){portfolio[projectId].staked=Math.max(0,portfolio[projectId].staked-1)}renderProjects()})}
    function openClaim(projectId){const amt=(portfolio[projectId]?.pendingRewards||0).toFixed(2);openModal('Claim Rewards',`<div class="text-sm">You are about to claim <strong>${amt} SOL</strong> from <strong>${projectName(projectId)}</strong>.</div>`,()=>{if(portfolio[projectId])portfolio[projectId].pendingRewards=0;renderProjects()})}
    function openClaimAll(){const total=Object.values(portfolio).reduce((a,b)=>a+(b.pendingRewards||0),0).toFixed(2);openModal('Claim All Rewards',`<div class="text-sm">This will claim <strong>${total} SOL</strong> across all projects with pending rewards.</div>`,()=>{Object.keys(portfolio).forEach(k=>portfolio[k].pendingRewards=0);renderProjects()})}
    function projectName(id){return PROJECTS.find(p=>p.id===id)?.name||id}
    const ownerPools=[];function submitPool(){if(!document.getElementById('f_terms').checked){alert('Please confirm terms.');return;}const data={name:g('f_name'),collection:g('f_collection'),token:v('f_token'),funding:g('f_funding'),apr:g('f_apr'),minlock:v('f_minlock'),slots:g('f_slots'),contact:g('f_contact'),site:g('f_site'),notes:g('f_notes'),status:'Pending review'};ownerPools.unshift(data);renderMyPools();openModal('Application submitted',`<div class='text-sm'>Your pool application for <strong>${data.name||'Unnamed Project'}</strong> has been recorded (UI demo).</div>`);resetForm(false)}
    function g(id){return document.getElementById(id).value.trim()}function v(id){return document.getElementById(id).value}
    function resetForm(clearTerms=true){['f_name','f_collection','f_funding','f_apr','f_slots','f_contact','f_site','f_notes'].forEach(id=>document.getElementById(id).value='');if(clearTerms)document.getElementById('f_terms').checked=false}
    function renderMyPools(){const box=document.getElementById('mypools');if(ownerPools.length===0){box.innerHTML='<div class="text-zinc-400">No pools yet.</div>';return;}box.innerHTML=ownerPools.map(p=>`<div class="glass rounded-xl p-3"><div class="font-medium">${p.name||'Untitled'}</div><div class="text-xs text-zinc-400 truncate">${p.collection}</div><div class="grid grid-cols-2 gap-2 text-xs mt-2"><div class="glass rounded-lg p-2 text-center">Token: <b>${p.token}</b></div><div class="glass rounded-lg p-2 text-center">APR: <b>${p.apr||'-'}</b></div><div class="glass rounded-lg p-2 text-center">Funding: <b>${p.funding||'-'}</b></div><div class="glass rounded-lg p-2 text-center">Slots: <b>${p.slots||'-'}</b></div></div><div class="mt-2 text-xs">Status: <span class="text-yellow-300">${p.status}</span></div><div class="mt-2 flex gap-2"><button class="btn btn-muted">View</button><button class="btn btn-muted">Edit</button></div></div>`).join('')}
    // Default route based on hash
    function initRoute(){const h=(location.hash||'').replace('#','');if(['user','owner','faq'].includes(h))openRoute(h);else openRoute('user');}
    window.addEventListener('hashchange',initRoute);initRoute();
  </script>

  <!-- Multi‑wallet detection -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.js"></script>
  <script>
    const CLUSTER='mainnet-beta';
    const ENDPOINT=(CLUSTER==='devnet')?'https://api.devnet.solana.com':'https://api.mainnet-beta.solana.com';
    let connection=null,activeProvider=null;const connectBtn=document.getElementById('connectBtn');const disconnectBtn=document.getElementById('disconnectBtn');const walletSelect=document.getElementById('walletSelect');
    function asArray(x){return Array.isArray(x)?x:(x?[x]:[]);}function labelForProvider(p){if(p?.isPhantom)return'Phantom';if(p?.isSolflare)return'Solflare';if(p?.isBackpack||p?.name==='Backpack')return'Backpack';if(p?.wallet?.name)return p.wallet.name;return'Wallet'}
    function getAllProviders(){const w=window;const s=new Set();asArray(w?.solana?.providers).forEach(p=>p&&s.add(p));if(w?.solana&&!asArray(w.solana.providers).length)s.add(w.solana);if(w?.backpack?.solana)s.add(w.backpack.solana);if(w?.phantom?.solana)s.add(w.phantom.solana);if(w?.solflare)s.add(w.solflare);return Array.from(s)}
    function populateWalletSelect(){const ps=getAllProviders();walletSelect.innerHTML='';ps.forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent=labelForProvider(p);walletSelect.appendChild(o)});walletSelect.classList.toggle('hidden',ps.length<=1);return ps}
    async function connectSelected(){const ps=populateWalletSelect();if(ps.length===0){window.open('https://phantom.app/','_blank');return}const idx=parseInt(walletSelect.value||'0',10)||0;const provider=ps[idx];try{const res=await provider.connect();const pk=res?.publicKey?.toString?.()||provider.publicKey?.toString?.();activeProvider=provider;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden');console.log(`[${labelForProvider(provider)}] Connected:`,pk)}catch(e){console.error(e);alert('Failed to connect wallet.')}}
    async function disconnectSelected(){try{await activeProvider?.disconnect?.()}catch(e){}activeProvider=null;connectBtn.classList.remove('hidden');disconnectBtn.classList.add('hidden')}
    connectBtn.addEventListener('click',connectSelected);disconnectBtn.addEventListener('click',disconnectSelected);
    for(const p of ps){try{const res=await p.connect({onlyIfTrusted:true});if(res?.publicKey||p.publicKey){activeProvider=p;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden');break}}catch(_){} }})
  </script>
</body>
</html>
