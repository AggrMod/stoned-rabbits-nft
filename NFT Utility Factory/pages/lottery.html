<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFT Utility Factory — Lottery Creator</title>
  <meta name="description" content="UI-only lottery creator for NFTs or coins with prize lock, duration, cancellation fee, and distribution settings." />
  <link rel="stylesheet" href="/css/styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen">
  <header class="navbar glass">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3">
      <img src="/images/Logo.jpg" alt="NFT Utility Factory" class="w-10 h-10 rounded-full"/>
      <span class="font-semibold tracking-wide">NFT Utility Factory</span>
    </a>
    <nav class="hidden md:flex items-center gap-6 text-sm text-zinc-300">
      <a href="/pages/staking.html" class="hover:text-white">Staking</a>
      <a href="/pages/airdrop.html" class="hover:text-white">Airdrop</a>
      <a href="/pages/discord-bot.html" class="hover:text-white">Discord Bot</a>
      <a href="/pages/lottery.html" class="hover:text-white">Lottery</a>
      <a href="/pages/pawnshop.html" class="hover:text-white">Pawn Shop</a>
      <a href="/pages/partner-casino.html" class="hover:text-white">Partner Casino</a>
      <a href="/pages/browser-game.html" class="hover:text-white">Browser Game</a>
      <a href="/index.html#contact" class="hover:text-white">Contact</a>
    </nav>
    <div class="flex items-center gap-2">
      <select id="walletSelect" class="hidden md:block px-3 py-2 rounded-xl glass text-sm"></select>
      <button id="connectBtn" class="btn btn-muted">Connect Wallet</button>
      <button id="disconnectBtn" class="btn btn-muted hidden">Disconnect</button>
    </div>
  </div>
</header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <section class="glass rounded-2xl p-5">
      <h1 class="text-2xl font-bold">Create a Lottery (UI‑only)</h1>
      <p class="small mt-1">Anyone with a connected wallet can create a lottery. Choose an NFT or coin as the prize. On submit, the prize is <b>locked</b> in a contract (mock here).</p>

      <div class="grid lg:grid-cols-3 gap-6 mt-4">
        <!-- Creator form -->
        <div class="lg:col-span-2 grid sm:grid-cols-2 gap-4">
          <div>
            <label class="small">Prize type</label>
            <select id="prizeType" class="w-full glass px-3 py-2 rounded-xl" onchange="togglePrizeFields()">
              <option value="nft">NFT</option>
              <option value="coin">Coin / Token</option>
            </select>
          </div>
          <div id="nftRow">
            <label class="small">Select NFT</label>
            <input id="nftMint" class="w-full glass px-3 py-2 rounded-xl" placeholder="NFT mint address from your wallet" />
          </div>
          <div id="coinRow" class="hidden">
            <label class="small">Select Coin & Amount</label>
            <div class="flex gap-2">
              <select id="coin" class="glass px-3 py-2 rounded-xl w-40">
                <option value="SOL">SOL</option>
                <option value="USDC">USDC</option>
                <option value="TOKEN">Custom SPL</option>
              </select>
              <input id="coinAmount" class="flex-1 glass px-3 py-2 rounded-xl" placeholder="e.g., 10" />
            </div>
          </div>
          <div>
            <label class="small">Duration</label>
            <div class="flex gap-2">
              <input id="duration" class="w-full glass px-3 py-2 rounded-xl" placeholder="e.g., 72 (hours)" />
              <span class="small self-center">hours</span>
            </div>
          </div>
          <div>
            <label class="small">Allow cancellation by creator?</label>
            <select id="cancellable" class="w-full glass px-3 py-2 rounded-xl">
              <option value="no">No</option>
              <option value="yes">Yes (extra fee)</option>
            </select>
          </div>
          <div class="sm:col-span-2">
            <label class="small">Distribution (for coins)</label>
            <div id="distRows" class="space-y-2">
              <div class="flex gap-2 items-center">
                <input class="glass px-3 py-2 rounded-xl w-1/2" data-k="place" placeholder="1st place" value="1st place" />
                <input class="glass px-3 py-2 rounded-xl w-1/2" data-k="percent" placeholder="%" value="100" />
                <button class="btn btn-muted" onclick="addDistRow()">+</button>
              </div>
            </div>
            <div class="small mt-2">Percentages should total 100%.</div>
          </div>
        </div>

        <!-- Preview / submit -->
        <aside class="glass rounded-2xl p-5">
          <h2 class="font-semibold">Preview</h2>
          <div id="preview" class="mt-3 small"></div>
          <div class="mt-4 flex gap-2">
            <button class="btn btn-muted" onclick="updatePreview()">Update Preview</button>
            <button class="btn btn-primary" onclick="submitLottery()">Submit Lottery</button>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <script>
    function togglePrizeFields(){
      const t=document.getElementById('prizeType').value;
      document.getElementById('nftRow').classList.toggle('hidden', t!=='nft');
      document.getElementById('coinRow').classList.toggle('hidden', t!=='coin');
    }
    function distRows(){
      return Array.from(document.querySelectorAll('#distRows .flex')).map(r=>({
        place: r.querySelector('[data-k="place"]').value.trim(),
        percent: parseFloat(r.querySelector('[data-k="percent"]').value || '0')
      }));
    }
    function addDistRow(){
      const wrap=document.getElementById('distRows');
      const div=document.createElement('div');
      div.className='flex gap-2 items-center';
      div.innerHTML=`<input class="glass px-3 py-2 rounded-xl w-1/2" data-k="place" placeholder="place" />
                     <input class="glass px-3 py-2 rounded-xl w-1/2" data-k="percent" placeholder="%" />
                     <button class="btn btn-muted" onclick="this.parentElement.remove();updatePreview()">−</button>`;
      wrap.appendChild(div);
      updatePreview();
    }
    function updatePreview(){
      const t=document.getElementById('prizeType').value;
      const nft=document.getElementById('nftMint').value;
      const coin=document.getElementById('coin').value;
      const amt=document.getElementById('coinAmount').value;
      const dur=document.getElementById('duration').value;
      const can=document.getElementById('cancellable').value;
      const rows=distRows();
      const totalPct=rows.reduce((a,b)=>a+(b.percent||0),0);
      let body='';
      body += `<div class='glass rounded-xl p-3'><div>Prize: <b>${t==='nft'?('NFT '+(nft||'')):(amt+' '+coin)}</b></div>`;
      body += `<div class='small'>Duration: <b>${dur||'?'}h</b> • Cancel: <b>${can}</b></div>`;
      if(t==='coin'){
        body += `<div class='small mt-2'>Distribution:</div>`;
        body += rows.map(r=>`<div class='small'>${r.place||'?'} — <b>${r.percent||0}%</b></div>`).join('');
        body += `<div class='small mt-2'>Total: <b>${totalPct}%</b> ${(totalPct!==100)?'<span style="color:#f87171">(must be 100%)</span>':''}</div>`;
      }
      body += `</div>`;
      document.getElementById('preview').innerHTML=body;
    }
    function submitLottery(){
      updatePreview();
      alert('UI-only: would lock the prize and post the lottery to the marketplace.');
    }
    togglePrizeFields();
    updatePreview();
  </script>

  <!-- Multi‑wallet (optional here) -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.js"></script>
  <script>
    const CLUSTER='mainnet-beta';
    const ENDPOINT=(CLUSTER==='devnet')?'https://api.devnet.solana.com':'https://api.mainnet-beta.solana.com';
    let connection=null,activeProvider=null;const connectBtn=document.getElementById('connectBtn');const disconnectBtn=document.getElementById('disconnectBtn');const walletSelect=document.getElementById('walletSelect');
    function asArray(x){return Array.isArray(x)?x:(x?[x]:[]);}function labelForProvider(p){if(p?.isPhantom)return'Phantom';if(p?.isSolflare)return'Solflare';if(p?.isBackpack||p?.name==='Backpack')return'Backpack';if(p?.wallet?.name)return p.wallet.name;return'Wallet'}
    function getAllProviders(){const w=window;const s=new Set();asArray(w?.solana?.providers).forEach(p=>p&&s.add(p));if(w?.solana&&!asArray(w.solana.providers).length)s.add(w.solana);if(w?.backpack?.solana)s.add(w.backpack.solana);if(w?.phantom?.solana)s.add(w.phantom.solana);if(w?.solflare)s.add(w.solflare);return Array.from(s)}
    function populateWalletSelect(){const ps=getAllProviders();walletSelect.innerHTML='';ps.forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent=labelForProvider(p);walletSelect.appendChild(o)});walletSelect.classList.toggle('hidden',ps.length<=1);return ps}
    async function connectSelected(){const ps=populateWalletSelect();if(ps.length===0){window.open('https://phantom.app/','_blank');return}const idx=parseInt(walletSelect.value||'0',10)||0;const provider=ps[idx];try{const res=await provider.connect();activeProvider=provider;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden')}catch(e){alert('Failed to connect wallet.')}}
    async function disconnectSelected(){try{await activeProvider?.disconnect?.()}catch(e){}activeProvider=null;connectBtn.classList.remove('hidden');disconnectBtn.classList.add('hidden')}
    connectBtn.addEventListener('click',connectSelected);disconnectBtn.addEventListener('click',disconnectSelected);
    for(const p of ps){try{const res=await p.connect({onlyIfTrusted:true});if(res?.publicKey||p.publicKey){activeProvider=p;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden');break}}catch(_){} }})
  </script>
</body>
</html>
