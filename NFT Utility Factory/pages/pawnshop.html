<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFT Utility Factory — Pawn Shop</title>
  <meta name="description" content="UI-only pawn shop to request storage/loan against NFTs or tokens with verification & age checks and valuation preview." />
  <link rel="stylesheet" href="/css/styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen">
  <header class="navbar glass">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3">
      <img src="/images/Logo.jpg" alt="NFT Utility Factory" class="w-10 h-10 rounded-full"/>
      <span class="font-semibold tracking-wide">NFT Utility Factory</span>
    </a>
    <nav class="hidden md:flex items-center gap-6 text-sm text-zinc-300">
      <a href="/pages/staking.html" class="hover:text-white">Staking</a>
      <a href="/pages/airdrop.html" class="hover:text-white">Airdrop</a>
      <a href="/pages/discord-bot.html" class="hover:text-white">Discord Bot</a>
      <a href="/pages/lottery.html" class="hover:text-white">Lottery</a>
      <a href="/pages/pawnshop.html" class="hover:text-white">Pawn Shop</a>
      <a href="/pages/partner-casino.html" class="hover:text-white">Partner Casino</a>
      <a href="/pages/browser-game.html" class="hover:text-white">Browser Game</a>
      <a href="/index.html#contact" class="hover:text-white">Contact</a>
    </nav>
    <div class="flex items-center gap-2">
      <select id="walletSelect" class="hidden md:block px-3 py-2 rounded-xl glass text-sm"></select>
      <button id="connectBtn" class="btn btn-muted">Connect Wallet</button>
      <button id="disconnectBtn" class="btn btn-muted hidden">Disconnect</button>
    </div>
  </div>
</header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <section class="glass rounded-2xl p-5">
      <h1 class="text-2xl font-bold">Pawn Shop (UI‑only)</h1>
      <p class="small mt-1">Request to store your NFT or token as collateral. We run basic checks and estimate value from average price in a look‑back window, then make an offer <b>10% below</b> that average (demo only).
      <br/>When a lock expires, you have <b>48 hours</b> to repay with penalty. After that, the item is raffled on the <a class="text-yellow-300 underline" href="/pages/lottery.html">lottery page</a> with preset terms.</p>

      <div class="grid lg:grid-cols-3 gap-6 mt-4">
        <!-- Request form -->
        <div class="lg:col-span-2 grid sm:grid-cols-2 gap-4">
          <div>
            <label class="small">Asset type</label>
            <select id="atype" class="w-full glass px-3 py-2 rounded-xl" onchange="toggleAssetFields()">
              <option value="nft">NFT</option>
              <option value="token">Token</option>
            </select>
          </div>
          <div>
            <label class="small">Lock duration</label>
            <select id="lock" class="w-full glass px-3 py-2 rounded-xl" onchange="updateLookback()">
              <option value="7">Max 7 days</option>
              <option value="30">Max 30 days</option>
              <option value="60">Max 60 days</option>
              <option value="90">Max 90 days</option>
            </select>
          </div>

          <div id="nftRow">
            <label class="small">NFT mint address</label>
            <input id="nftMint" class="w-full glass px-3 py-2 rounded-xl" placeholder="NFT mint" />
            <div class="small mt-1">Requirements: verified collection • listed on Magic Eden • age ≥ 30 days.</div>
          </div>
          <div id="tokenRow" class="hidden">
            <label class="small">Token (SPL) & amount</label>
            <div class="flex gap-2">
              <input id="tokenMint" class="glass px-3 py-2 rounded-xl w-2/3" placeholder="Token mint (e.g., USDC)" />
              <input id="tokenAmt" class="glass px-3 py-2 rounded-xl w-1/3" placeholder="Amount" />
            </div>
            <div class="small mt-1">Requirements: verified token • traded on Jupiter or Raydium • age ≥ 30 days.</div>
          </div>

          <div class="sm:col-span-2 grid sm:grid-cols-3 gap-3">
            <label class="glass rounded-xl p-3 flex items-center gap-2 text-sm"><input type="checkbox" class="accent-yellow-400" id="verified"/> Verified (collection / token)</label>
            <label class="glass rounded-xl p-3 flex items-center gap-2 text-sm"><input type="checkbox" class="accent-yellow-400" id="listed"/> Listed on Magic Eden / Jupiter / Raydium</label>
            <label class="glass rounded-xl p-3 flex items-center gap-2 text-sm"><input type="checkbox" class="accent-yellow-400" id="age"/> Age ≥ 30 days</label>
          </div>

          <div class="sm:col-span-2">
            <label class="small">Look‑back window (auto from lock)</label>
            <div class="flex gap-2">
              <input id="lookback" class="w-24 glass px-3 py-2 rounded-xl" readonly />
              <button class="btn btn-muted" onclick="simulateValuation()">Simulate Valuation</button>
            </div>
            <div class="small mt-2">Average price over the window → offer is 10% below the average.</div>
          </div>
        </div>

        <!-- Preview / offer -->
        <aside class="glass rounded-2xl p-5">
          <h2 class="font-semibold">Offer Preview</h2>
          <div id="offer" class="mt-3 small"></div>
          <div class="mt-4 flex gap-2"><button class="btn btn-primary" onclick="submitRequest()">Submit Request</button><button class="btn btn-muted" onclick="resetForm()">Reset</button></div>
          <div class="small mt-3">If approved, collateral is locked until repaid. After expiry + 48h, it will be raffled on the lottery page.</div>
        </aside>
      </div>
    </section>
  </main>

  <script>
    function toggleAssetFields(){
      const t=document.getElementById('atype').value;
      document.getElementById('nftRow').classList.toggle('hidden', t!=='nft');
      document.getElementById('tokenRow').classList.toggle('hidden', t!=='token');
    }
    function updateLookback(){
      document.getElementById('lookback').value = document.getElementById('lock').value + ' days';
    }
    function checksOk(){
      const ok = document.getElementById('verified').checked && document.getElementById('listed').checked && document.getElementById('age').checked;
      return ok;
    }
    function simulateValuation(){
      updateLookback();
      const days=parseInt(document.getElementById('lock').value,10)||7;
      // Demo: mock average based on random sample
      const base=(Math.random()*9+1).toFixed(2); // 1..10 (mock)
      const avg=(parseFloat(base)+days/100).toFixed(2);
      const offer=(avg*0.9).toFixed(2);
      const asset = (document.getElementById('atype').value==='nft') ? 'NFT floor (SOL)' : 'token price (SOL)';
      document.getElementById('offer').innerHTML = `
        <div class='glass rounded-xl p-3'>
          <div>Checks: ${checksOk()? '<b style="color:#22c55e">PASSED</b>' : '<b style="color:#f87171">FAILED</b>'}</div>
          <div class='small mt-1'>Look‑back: <b>${days}d</b> • Avg ${asset}: <b>${avg}</b></div>
          <div class='small'>Offer (10% below avg): <b>${offer} SOL</b></div>
        </div>`;
    }
    function submitRequest(){
      if(!checksOk()){ alert('Please meet all requirements first (verified, listed, age ≥ 30 days).'); return; }
      simulateValuation();
      alert('UI-only: would send your request for review and lock collateral on acceptance.');
    }
    function resetForm(){
      ['nftMint','tokenMint','tokenAmt'].forEach(id=>{const el=document.getElementById(id); if(el) el.value='';});
      ['verified','listed','age'].forEach(id=>document.getElementById(id).checked=false);
      document.getElementById('atype').value='nft';
      document.getElementById('lock').value='7';
      toggleAssetFields();
      updateLookback();
      document.getElementById('offer').innerHTML='';
    }
    toggleAssetFields();
    updateLookback();
  </script>

  <!-- Multi‑wallet (optional here) -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.js"></script>
  <script>
    const CLUSTER='mainnet-beta';
    const ENDPOINT=(CLUSTER==='devnet')?'https://api.devnet.solana.com':'https://api.mainnet-beta.solana.com';
    let connection=null,activeProvider=null;const connectBtn=document.getElementById('connectBtn');const disconnectBtn=document.getElementById('disconnectBtn');const walletSelect=document.getElementById('walletSelect');
    function asArray(x){return Array.isArray(x)?x:(x?[x]:[]);}function labelForProvider(p){if(p?.isPhantom)return'Phantom';if(p?.isSolflare)return'Solflare';if(p?.isBackpack||p?.name==='Backpack')return'Backpack';if(p?.wallet?.name)return p.wallet.name;return'Wallet'}
    function getAllProviders(){const w=window;const s=new Set();asArray(w?.solana?.providers).forEach(p=>p&&s.add(p));if(w?.solana&&!asArray(w.solana.providers).length)s.add(w.solana);if(w?.backpack?.solana)s.add(w.backpack.solana);if(w?.phantom?.solana)s.add(w.phantom.solana);if(w?.solflare)s.add(w.solflare);return Array.from(s)}
    function populateWalletSelect(){const ps=getAllProviders();walletSelect.innerHTML='';ps.forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent=labelForProvider(p);walletSelect.appendChild(o)});walletSelect.classList.toggle('hidden',ps.length<=1);return ps}
    async function connectSelected(){const ps=populateWalletSelect();if(ps.length===0){window.open('https://phantom.app/','_blank');return}const idx=parseInt(walletSelect.value||'0',10)||0;const provider=ps[idx];try{const res=await provider.connect();activeProvider=provider;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden')}catch(e){alert('Failed to connect wallet.')}}
    async function disconnectSelected(){try{await activeProvider?.disconnect?.()}catch(e){}activeProvider=null;connectBtn.classList.remove('hidden');disconnectBtn.classList.add('hidden')}
    connectBtn.addEventListener('click',connectSelected);disconnectBtn.addEventListener('click',disconnectSelected);
    for(const p of ps){try{const res=await p.connect({onlyIfTrusted:true});if(res?.publicKey||p.publicKey){activeProvider=p;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden');break}}catch(_){} }})
  </script>
</body>
</html>
