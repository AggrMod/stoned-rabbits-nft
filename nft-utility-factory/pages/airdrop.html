<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFT Utility Factory — Airdrop Sender</title>
  <meta name="description" content="UI-only airdrop configuration with snapshots for Solana NFT collections." />
  <link rel="stylesheet" href="/css/styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen">
  <header class="navbar glass">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3">
      <img src="/images/Logo.jpg" alt="NFT Utility Factory" class="w-10 h-10 rounded-full"/>
      <span class="font-semibold tracking-wide">NFT Utility Factory</span>
    </a>
    <nav class="hidden md:flex items-center gap-6 text-sm text-zinc-300">
      <a href="/pages/staking.html" class="hover:text-white">Staking</a>
      <a href="/pages/airdrop.html" class="hover:text-white">Airdrop</a>
      <a href="/pages/discord-bot.html" class="hover:text-white">Discord Bot</a>
      <a href="/pages/lottery.html" class="hover:text-white">Lottery</a>
      <a href="/pages/pawnshop.html" class="hover:text-white">Pawn Shop</a>
      <a href="/pages/partner-casino.html" class="hover:text-white">Partner Casino</a>
      <a href="/pages/browser-game.html" class="hover:text-white">Browser Game</a>
      <a href="/index.html#contact" class="hover:text-white">Contact</a>
    </nav>
    <div class="flex items-center gap-2">
      <select id="walletSelect" class="hidden md:block px-3 py-2 rounded-xl glass text-sm"></select>
      <button id="connectBtn" class="btn btn-muted">Connect Wallet</button>
      <button id="disconnectBtn" class="btn btn-muted hidden">Disconnect</button>
    </div>
  </div>
</header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="grid lg:grid-cols-3 gap-6">
      <section class="lg:col-span-2 glass rounded-2xl p-5">
        <h1 class="text-2xl font-bold">Airdrop Sender (UI‑only)</h1>
        <p class="small mt-1">Set up airdrops using automated snapshots. Replace submit logic with your backend later.</p>

        <div class="grid sm:grid-cols-2 gap-4 mt-4">
          <div><label class="small">Collection ID</label><input id="col" class="w-full glass px-3 py-2 rounded-xl" placeholder="Collection address / verified creator"/></div>
          <div><label class="small">Snapshot type</label><select id="snap" class="w-full glass px-3 py-2 rounded-xl"><option>Holders</option><option>Stakers</option><option>CSV Allowlist</option></select></div>
          <div><label class="small">Asset</label><select id="asset" class="w-full glass px-3 py-2 rounded-xl"><option>SOL</option><option>USDC</option><option>Custom SPL Token</option></select></div>
          <div><label class="small">Total amount</label><input id="amount" class="w-full glass px-3 py-2 rounded-xl" placeholder="e.g., 500"/></div>
          <div><label class="small">Distribution rule</label><select id="rule" class="w-full glass px-3 py-2 rounded-xl"><option>Equal per wallet</option><option>Pro‑rata by holdings</option><option>Fixed per NFT</option></select></div>
          <div><label class="small">CSV allowlist (optional)</label><input id="csv" type="file" accept=".csv" class="w-full glass px-3 py-2 rounded-xl"/></div>
        </div>

        <div class="mt-4 flex gap-3">
          <button class="btn btn-muted" onclick="takeSnapshot()">Take Snapshot</button>
          <button class="btn btn-primary" onclick="simulateDistribution()">Simulate Distribution</button>
          <button class="btn btn-muted" onclick="resetForm()">Reset</button>
        </div>

        <div id="results" class="mt-6"></div>
      </section>

      <aside class="glass rounded-2xl p-5">
        <h2 class="font-semibold">Recent Snapshots</h2>
        <div id="snaps" class="mt-3 space-y-3 text-sm"></div>
      </aside>
    </div>
  </main>

  <script>
    const snapshots=[];
    function el(id){return document.getElementById(id)}
    function resetForm(){['col','amount'].forEach(i=>el(i).value='');['snap','asset','rule'].forEach(i=>el(i).selectedIndex=0);el('csv').value='';el('results').innerHTML=''}
    function takeSnapshot(){const s={time:new Date().toLocaleString(),collection:el('col').value||'(missing)',type:el('snap').value,size:Math.floor(Math.random()*500)+50};snapshots.unshift(s);renderSnapshots();el('results').innerHTML=`<div class='glass rounded-xl p-4'><div class='font-medium'>Snapshot taken</div><div class='small'>Collection: <b>${s.collection}</b> • Type: <b>${s.type}</b> • Wallets: <b>${s.size}</b></div></div>`}
    function simulateDistribution(){const size=snapshots[0]?.size||120;const total=parseFloat(el('amount').value||'0');const rule=el('rule').value;const asset=el('asset').value;let preview='';if(total<=0){alert('Enter a valid total amount');return}
      if(rule==='Equal per wallet'){preview=`Each wallet receives <b>${(total/size).toFixed(4)} ${asset}</b>.`}else if(rule==='Pro‑rata by holdings'){preview=`Distribution weighted by holdings (mock preview).`}else{preview=`Each NFT gets <b>${(total/size).toFixed(4)} ${asset}</b> (assuming 1 NFT per wallet in demo).`}
      el('results').innerHTML=`<div class='glass rounded-xl p-4'><div class='font-medium'>Simulation</div><div class='small'>Wallets: <b>${size}</b> • Total: <b>${total} ${asset}</b></div><div class='mt-2 small'>${preview}</div><div class='mt-3'><button class='btn btn-primary'>Confirm & Queue Airdrop</button></div></div>`}
    function renderSnapshots(){const box=el('snaps');box.innerHTML=snapshots.length? snapshots.map(s=>`<div class='glass rounded-xl p-3'><div class='font-medium truncate'>${s.collection}</div><div class='small'>${s.type} • ${s.time}</div><div class='small'>Wallets: ${s.size}</div></div>`).join('') : `<div class='small'>No snapshots yet.</div>`}
    renderSnapshots();
  </script>

  <!-- Multi‑wallet (optional here, UI only now) -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.js"></script>
  <script>
    const CLUSTER='mainnet-beta';
    const ENDPOINT=(CLUSTER==='devnet')?'https://api.devnet.solana.com':'https://api.mainnet-beta.solana.com';
    let connection=null,activeProvider=null;const connectBtn=document.getElementById('connectBtn');const disconnectBtn=document.getElementById('disconnectBtn');const walletSelect=document.getElementById('walletSelect');
    function asArray(x){return Array.isArray(x)?x:(x?[x]:[]);}function labelForProvider(p){if(p?.isPhantom)return'Phantom';if(p?.isSolflare)return'Solflare';if(p?.isBackpack||p?.name==='Backpack')return'Backpack';if(p?.wallet?.name)return p.wallet.name;return'Wallet'}
    function getAllProviders(){const w=window;const s=new Set();asArray(w?.solana?.providers).forEach(p=>p&&s.add(p));if(w?.solana&&!asArray(w.solana.providers).length)s.add(w.solana);if(w?.backpack?.solana)s.add(w.backpack.solana);if(w?.phantom?.solana)s.add(w.phantom.solana);if(w?.solflare)s.add(w.solflare);return Array.from(s)}
    function populateWalletSelect(){const ps=getAllProviders();walletSelect.innerHTML='';ps.forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent=labelForProvider(p);walletSelect.appendChild(o)});walletSelect.classList.toggle('hidden',ps.length<=1);return ps}
    async function connectSelected(){const ps=populateWalletSelect();if(ps.length===0){window.open('https://phantom.app/','_blank');return}const idx=parseInt(walletSelect.value||'0',10)||0;const provider=ps[idx];try{const res=await provider.connect();activeProvider=provider;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden')}catch(e){alert('Failed to connect wallet.')}}
    async function disconnectSelected(){try{await activeProvider?.disconnect?.()}catch(e){}activeProvider=null;connectBtn.classList.remove('hidden');disconnectBtn.classList.add('hidden')}
    connectBtn.addEventListener('click',connectSelected);disconnectBtn.addEventListener('click',disconnectSelected);
    for(const p of ps){try{const res=await p.connect({onlyIfTrusted:true});if(res?.publicKey||p.publicKey){activeProvider=p;connection=new solanaWeb3.Connection(ENDPOINT,'confirmed');connectBtn.classList.add('hidden');disconnectBtn.classList.remove('hidden');break}}catch(_){} }})
  </script>
</body>
</html>
